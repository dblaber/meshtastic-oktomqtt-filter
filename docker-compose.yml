version: '3.8'

services:
  mqtt-filter:
    build: .
    container_name: meshtastic-mqtt-filter
    restart: unless-stopped
    environment:
      # Override these in a .env file or docker-compose.override.yml
      - MQTT_BROKER=${MQTT_BROKER:-mqtt.patinhas.da4.org}
      - MQTT_PORT=${MQTT_PORT:-1883}
      - MQTT_USERNAME=${MQTT_USERNAME:-meshdev}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-replaceme}
      - INPUT_TOPIC=${INPUT_TOPIC:-msh/US/NY/#}
      - OUTPUT_TOPIC=${OUTPUT_TOPIC:-filtered/msh/US/NY}
      - SHOW_STATS=${SHOW_STATS:-true}
      - DEBUG=${DEBUG:-false}
      - NO_DECRYPT_DEFAULT=${NO_DECRYPT_DEFAULT:-false}
      - ALLOW_NO_BITFIELD=${ALLOW_NO_BITFIELD:-false}
      - REJECT_LOG_FILE=${REJECT_LOG_FILE:-}
      # Comma-separated list of exempt node IDs (supports: 0xABCD1234, !a1b2c3d4, ABCD1234, or decimal)
      - EXEMPT_NODES=${EXEMPT_NODES:-}
      # Comma-separated list of channel encryption keys (base64)
      - CHANNEL_KEYS=${CHANNEL_KEYS:-}
    volumes:
      # Mount logs directory if REJECT_LOG_FILE is used
      - ${LOGS_DIR:-./logs}:/app/logs
